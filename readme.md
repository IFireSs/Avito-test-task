## **Сервис назначения ревьюеров для Pull Request’ов**

Внутри команды требуется единый микросервис, который автоматически назначает ревьюеров на Pull Request’ы (PR), а также позволяет управлять командами и участниками. Взаимодействие происходит исключительно через HTTP API.

## **Инструкция по запуску**
#### Из корня репозитория
docker compose up --build

Ручной запуск тестов: docker compose -f docker-compose.test.yml up --build --abort-on-container-exit tests

## **Описание задачи**

Необходимо реализовать сервис, который назначает ревьюеров на PR из команды автора, позволяет выполнять переназначение ревьюверов и получать список PR’ов, назначенных конкретному пользователю, а также управлять командами и активностью пользователей. После merge PR изменение состава ревьюверов запрещено.

## **Общие вводные**

**Пользователь (User)** — участник команды с уникальным идентификатором, именем и флагом активности `isActive`.

**Команда (Team)** — группа пользователей с уникальным именем.

**Pull Request (PR)** — сущность с идентификатором, названием, автором, статусом `OPEN|MERGED`и списком назначенных ревьюверов (до 2).

1. При создании PR автоматически назначаются **до двух** активных ревьюверов из **команды автора**, исключая самого автора.
2. Переназначение заменяет одного ревьювера на случайного **активного** участника **из команды заменяемого** ревьювера.
3. После `MERGED` менять список ревьюверов **нельзя**.
4. Если доступных кандидатов меньше двух, назначается доступное количество (0/1).

## **Стек**

- Go 1.24
- PostgreSQL 16
- Миграции: Flyway
- Генерация HTTP-слоя: `oapi-codegen` по `internal/api/openapi.yml`
- Тесты: `go test ./tests`
- Нагрузочное тестирование: Яндекс.Танк

## **Ход решения**

- На основе openapi использовал oapi-codegen
- Из задания убрали админский токен, но для деактивации пользователей его отсутствие выглядит странно, поэтому в качестве допущения оставил его опциональным в виде переменной окружения ADMIN_TOKEN. Если не задан - не требуется. дефолтный - avito-internship
- Добавил в api несколько ручек по доп заданиям (статистика назначений по пользователям и массовая деактивация)
- Так же добавил ручку /swagger, по которой доступна итоговая api
- В изначальной api исправил пример для pullRequest/reassign, было что то вроде old_reviewer_id, а в изначальной спецификации old_user_id
- Покрыл бизнес-логику интеграционными тестами, так же реализовал тестовую бд для изолированного тестирования работы с postgres
- Не увидел в задании логирования, добавил самое простое
- В ходе работы с линтером возникли проблемы, с проверкой файлов репозиториев, а именно pgx на typecheck, решить проблему не удалось, поэтому добавил их в игнор.
- В миграции V2 добавил тестовые данные для ручного тестирования
- Нагрузочное тестирование провел с помощью Яндекс.Танк, конфигурации в папке loadtest (load_original - требования по заданию, load - более высокая нагрузка)


## **Результаты нагрузочного тестирования**

Тест на требуемых условиях

- Длительность теста: ~5 минут
- Средний RPS: ~5 req/s
- Общее число запросов: ~300
- Ошибки: 0 (0%)
- Время ответа:
    - avg: ~0.9 ms
    - p95: ~1.4 ms
    - p99: ~2.3 ms

Результаты тестов при нагрузке 1000 rps

HTTP-результаты
- Всего запросов	179 517
- Код ответа	200 OK — 100 %
- Ошибки сети	0
- Ошибки HTTP	0
- Успешных ответов	100 %

Время отклика
- 100 % (максимум)	21.0 мс
- 99.5 %	1.2 мс
- 99.0 %	1.0 мс
- 95.0 %	0.8 мс
- 90.0 %	0.7 мс
- 80.0 %	0.6 мс
- 50.0 % (медиана)	0.5 мс
- 10.0 %	0.3 мс

Сводка

- Среднее время отклика: 0.48 мс
- Среднее время подключения: 0.09 мс
- Отправка данных: 0.01 мс
- Ожидание (latency): 0.34 мс
- Получение ответа: 0.04 мс